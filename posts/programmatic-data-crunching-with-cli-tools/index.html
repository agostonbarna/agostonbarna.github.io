<!doctype html><html lang=en><head><title>Programmatic data crunching with CLI tools · Barna's blog
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Barnabás Ágoston"><meta name=description content="As a software engineer we often need to closely examine the data we work with. To name a few examples:

We need to implement a new feature that consumes an external service, but the quality of the API documentation can vary, and it may not always provide a comprehensive overview of the structure of the data, nor give a complete picture of the actual data it holds. So it may be necessary to analyze the data in the API responses before we implement the client-side logic to avoid surprises when going live.
We are debugging a problem that requires querying and analyzing large amounts of data (e.g. APIs, databases, log files) to identify the culprit.
We are preparing a complex migration that significantly alter the structure of the data. Our goal is to automate the process as much as possible, and verify that no data is lost in the end.
We get a request to crunch some data from a system and generate reports out of it (e.g. for the PM, product owners, or customer).
"><meta name=keywords content="blog,software-engineer,developer,cli"><meta name=twitter:card content="summary"><meta name=twitter:title content="Programmatic data crunching with CLI tools"><meta name=twitter:description content="As a software engineer we often need to closely examine the data we work with. To name a few examples:
We need to implement a new feature that consumes an external service, but the quality of the API documentation can vary, and it may not always provide a comprehensive overview of the structure of the data, nor give a complete picture of the actual data it holds. So it may be necessary to analyze the data in the API responses before we implement the client-side logic to avoid surprises when going live. We are debugging a problem that requires querying and analyzing large amounts of data (e.g. APIs, databases, log files) to identify the culprit. We are preparing a complex migration that significantly alter the structure of the data. Our goal is to automate the process as much as possible, and verify that no data is lost in the end. We get a request to crunch some data from a system and generate reports out of it (e.g. for the PM, product owners, or customer)."><meta property="og:url" content="https://agostonbarna.github.io/posts/programmatic-data-crunching-with-cli-tools/"><meta property="og:site_name" content="Barna's blog"><meta property="og:title" content="Programmatic data crunching with CLI tools"><meta property="og:description" content="As a software engineer we often need to closely examine the data we work with. To name a few examples:
We need to implement a new feature that consumes an external service, but the quality of the API documentation can vary, and it may not always provide a comprehensive overview of the structure of the data, nor give a complete picture of the actual data it holds. So it may be necessary to analyze the data in the API responses before we implement the client-side logic to avoid surprises when going live. We are debugging a problem that requires querying and analyzing large amounts of data (e.g. APIs, databases, log files) to identify the culprit. We are preparing a complex migration that significantly alter the structure of the data. Our goal is to automate the process as much as possible, and verify that no data is lost in the end. We get a request to crunch some data from a system and generate reports out of it (e.g. for the PM, product owners, or customer)."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-26T00:00:00+00:00"><meta property="article:modified_time" content="2024-02-26T00:00:00+00:00"><link rel=canonical href=https://agostonbarna.github.io/posts/programmatic-data-crunching-with-cli-tools/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.9179c1d90f64a0de8a86e39c8cb9353cec006be6b110f5b2520374980e39d511.css integrity="sha256-kXnB2Q9koN6KhuOcjLk1POwAa+axEPWyUgN0mA451RE=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.20d53244d4483d3fdab5c48d94c7ecec649c5d5e18eaf8ef698c5e57cda38390.css integrity="sha256-INUyRNRIPT/atcSNlMfs7GScXV4Y6vjvaYxeV82jg5A=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/extra.min.767ad20582086ff614507369355e433d328fe0fd66e0923a057fcd14ede391b3.css integrity="sha256-dnrSBYIIb/YUUHNpNV5DPTKP4P1m4JI6BX/NFO3jkbM=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://agostonbarna.github.io/>Barna's blog
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts>Posts</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://agostonbarna.github.io/posts/programmatic-data-crunching-with-cli-tools/>Programmatic data crunching with CLI tools</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-02-26T00:00:00Z>February 26, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
22-minute read</span></div></div></header><div class=post-content><p>As a software engineer we often need to closely examine the data we work with. To name a few examples:</p><ul><li>We need to implement a new feature that consumes an external service, but the quality of the API documentation can vary, and it may not always provide a comprehensive overview of the structure of the data, nor give a complete picture of the actual data it holds. So it may be necessary to analyze the data in the API responses before we implement the client-side logic to avoid surprises when going live.</li><li>We are debugging a problem that requires querying and analyzing large amounts of data (e.g. APIs, databases, log files) to identify the culprit.</li><li>We are preparing a complex migration that significantly alter the structure of the data. Our goal is to automate the process as much as possible, and verify that no data is lost in the end.</li><li>We get a request to crunch some data from a system and generate reports out of it (e.g. for the PM, product owners, or customer).</li></ul><p>I prefer using CLI tools over GUI apps for these kinds of tasks for several reasons:</p><ul><li>The Unix philosophy played a significant role in shaping the design of CLI tools and provided an excellent foundation to build on, with the main idea that each program does one thing well, and uses a universal interface (text streams). This allows programs to be easily combined in an effectively infinite number of ways, making it possible to solve a diverse set of problems. Huge, standalone programs on the other hand are less flexible, and harder to extend and maintain.</li><li>CLI tools can be used in an automated fashion, so for example if we need to create a report periodically, we only have to write the right combination of commands and queries once, and simply rerun it on subsequent occasions.</li><li>Even if we need to generate a different report than we did in the past, we can likely reuse some parts of the previous commands/queries, and we can also extract some common patterns to aliases, functions, scripts, etc. to abstract away the complex logic and make it easier to use.</li><li>Many CLI tools are available on headless servers as well, which reduces the amount of back-and-forth <code>scp</code>-ing during data crunching iterations.</li><li>CLI tools generally have lower overhead than GUI apps due to their lightweight nature which can result in reduced resource usage and higher performance.</li><li>There are plenty of open-source CLI tools out there. With open-source programs, we don&rsquo;t have to worry about vendor lock-in, we can inspect the code to make sure that it&rsquo;s not collecting and selling sensitive data, we can request new features or contribute, open bug tickets, debug and fix bugs ourselves, and so on.</li></ul><p><strong>NOTE:</strong> This blog post is geared towards those who already have some basic shell scripting skills on Linux or macOS environments with <code>bash</code> or <code>zsh</code> shells, as I don&rsquo;t go into the shell basics here and only tried these commands in said environments and shells.</p><h2 id=json>JSON
<a class=heading-link href=#json><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>JSON is a widely adopted data format, used in many (e.g. web) applications these days. JSON APIs can return large amounts of data though, which often gets condensed into a single-line format to lower the overhead, but making it hard to read and analyze for humans out of the box.</p><h3 id=fastgron>fastgron
<a class=heading-link href=#fastgron><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>The first tool that comes to our rescue is <a href=https://github.com/adamritter/fastgron class=external-link target=_blank rel=noopener>fastgron</a>. It can flatten a deeply nested JSON structure into discrete <code>.path.to.key = value</code> lines, making it possible to use tools like <code>grep</code> to quickly find some patterns even in a huge JSON and reveal their exact path all the way up from the JSON root. This JSON path is also quite handy when writing <code>jq</code> queries (more about that in the next section). My usual workflow is this: first explore the JSON with some quick <code>fastgron</code> + <code>grep</code> commands, and then combine the located paths (identifier-indexes) with more fine-grained queries and transformations in <code>jq</code> to get the desired output.</p><p><strong>NOTE:</strong> the <code>--root ''</code> option removes the <code>json</code> prefix from <code>fastgron</code>&rsquo;s output which is not necessary. This makes the path a usable identifier-index filter in <code>jq</code>.</p><details><summary><strong>Examples:</strong> (click to expand)</summary><p><strong>Flatten a JSON:</strong></p><p>input.json:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;id&#34;</span>: <span style=color:#98c379>&#34;1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;name&#34;</span>: <span style=color:#98c379>&#34;John Doe&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;address&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#e06c75>&#34;city&#34;</span>: <span style=color:#98c379>&#34;Paris&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e06c75>&#34;country&#34;</span>: <span style=color:#98c379>&#34;France&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;id&#34;</span>: <span style=color:#98c379>&#34;2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;name&#34;</span>: <span style=color:#98c379>&#34;Jane Doe&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;address&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#e06c75>&#34;city&#34;</span>: <span style=color:#98c379>&#34;Rome&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e06c75>&#34;country&#34;</span>: <span style=color:#98c379>&#34;Italy&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json fastgron --root <span style=color:#98c379>&#39;&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span> = []
</span></span><span style=display:flex><span>[<span style=color:#d19a66>0</span>] = {}
</span></span><span style=display:flex><span>[<span style=color:#d19a66>0</span>].id = <span style=color:#98c379>&#34;1&#34;</span>
</span></span><span style=display:flex><span>[<span style=color:#d19a66>0</span>].name = <span style=color:#98c379>&#34;John Doe&#34;</span>
</span></span><span style=display:flex><span>[<span style=color:#d19a66>0</span>].address = {}
</span></span><span style=display:flex><span>[<span style=color:#d19a66>0</span>].address.city = <span style=color:#98c379>&#34;Paris&#34;</span>
</span></span><span style=display:flex><span>[<span style=color:#d19a66>0</span>].address.country = <span style=color:#98c379>&#34;France&#34;</span>
</span></span><span style=display:flex><span>[<span style=color:#d19a66>1</span>] = {}
</span></span><span style=display:flex><span>[<span style=color:#d19a66>1</span>].id = <span style=color:#98c379>&#34;2&#34;</span>
</span></span><span style=display:flex><span>[<span style=color:#d19a66>1</span>].name = <span style=color:#98c379>&#34;Jane Doe&#34;</span>
</span></span><span style=display:flex><span>[<span style=color:#d19a66>1</span>].address = {}
</span></span><span style=display:flex><span>[<span style=color:#d19a66>1</span>].address.city = <span style=color:#98c379>&#34;Rome&#34;</span>
</span></span><span style=display:flex><span>[<span style=color:#d19a66>1</span>].address.country = <span style=color:#98c379>&#34;Italy&#34;</span>
</span></span></code></pre></div><p><strong>Unflatten a flattened JSON:</strong></p><p><code>fastgron</code> can also unflatten its own flattened JSON output back to a nested JSON with the <code>-u</code> flag. In case we did some <code>grep</code>-ing before, the unflattened output will result in a smaller JSON with a subset of <code>key:values</code>, but it keeps the original JSON structure.</p><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json fastgron --root <span style=color:#98c379>&#39;&#39;</span> | grep name | fastgron --root <span style=color:#98c379>&#39;&#39;</span> -u
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;name&#34;</span>: <span style=color:#98c379>&#34;John Doe&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;name&#34;</span>: <span style=color:#98c379>&#34;Jane Doe&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p><strong>fastgron wrapper with auto-pager:</strong></p><p>A formatted JSON can be pretty lengthy so if we simply dump it out, then the terminal buffer might fill up and cut off the beginning of the data. It can be also tedious to manually scroll to the top of the terminal each time after we change something and run the command, so I created a little shell wrapper function which makes sure the output is piped to a pager (<code>less</code>) with interactive navigation and syntax highlighting if the stdout is a tty/terminal, unless we do some further piping or redirecting the output to a file as we don&rsquo;t want to clutter the plain text output with the ANSI color codes in these cases:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#7f848e># jf: JSON flattener</span>
</span></span><span style=display:flex><span>jf<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>local</span> <span style=color:#e06c75>cmd_base</span><span style=color:#56b6c2>=(</span>fastgron --root <span style=color:#98c379>&#39;&#39;</span><span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> -t <span style=color:#d19a66>1</span> <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span> <span style=color:#7f848e># if stdout is a tty</span>
</span></span><span style=display:flex><span>    <span style=color:#98c379>&#34;</span><span style=color:#98c379>${</span><span style=color:#e06c75>cmd_base</span>[@]<span style=color:#98c379>}</span><span style=color:#98c379>&#34;</span> -c <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span> | less -R
</span></span><span style=display:flex><span>  <span style=color:#c678dd>else</span> <span style=color:#7f848e># if stdout is redirected to a pipe or file</span>
</span></span><span style=display:flex><span>    <span style=color:#98c379>&#34;</span><span style=color:#98c379>${</span><span style=color:#e06c75>cmd_base</span>[@]<span style=color:#98c379>}</span><span style=color:#98c379>&#34;</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e># juf: JSON unflattener</span>
</span></span><span style=display:flex><span>juf<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  jf -u | jq
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div></details><h3 id=jq>jq
<a class=heading-link href=#jq><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><a href=https://jqlang.github.io/jq/ class=external-link target=_blank rel=noopener>jq</a> is an incredibly powerful JSON querying tool that has proven to be invaluable to me over the years. It has its own concise and expressive language (DSL) to query JSON structures that takes some time to really wrap our head around, and requires learning a couple of new concepts before we could utilize its full potential, but it can spare us a lot of time on the long run if we often have to query JSON inputs.</p><p>I try to cover the basics here with some examples.</p><details><summary><strong>Examples:</strong> (click to expand)</summary><h4 id=formatting>Formatting
<a class=heading-link href=#formatting><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>If we simply redirect or pipe a JSON into <code>jq</code>, it formats a single-line condensed JSON and also does syntax highlighting out of the box.</p><p><strong>Expanding:</strong></p><p>input.json:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#e06c75>&#34;key1&#34;</span>:<span style=color:#98c379>&#34;value1&#34;</span>,<span style=color:#e06c75>&#34;key2&#34;</span>:<span style=color:#98c379>&#34;value2&#34;</span>}
</span></span></code></pre></div><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq . <span style=color:#7f848e># . is the identity operator which simply returns the full input and optional to use if we pass in an stdin instead of a file</span>
</span></span></code></pre></div><p>output.json:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;key1&#34;</span>: <span style=color:#98c379>&#34;value1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;key2&#34;</span>: <span style=color:#98c379>&#34;value2&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Condensing:</strong></p><p>We can also do it the other way around and formatted JSON into a compact single-line with the <code>-c</code> flag:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq -c .
</span></span></code></pre></div><h4 id=streams>Streams
<a class=heading-link href=#streams><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>To put it simply, streams in <code>jq</code> mean line-delimited JSON input or output. Also see the <a href=https://jsonlines.org class=external-link target=_blank rel=noopener>JSON Lines</a> text format.</p><p><strong>Compact stream input -> formatted stream output:</strong></p><p>input.json:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#e06c75>&#34;key1&#34;</span>:<span style=color:#98c379>&#34;value1&#34;</span>,<span style=color:#e06c75>&#34;key2&#34;</span>:<span style=color:#98c379>&#34;value2&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#e06c75>&#34;key3&#34;</span>:<span style=color:#98c379>&#34;value3&#34;</span>,<span style=color:#e06c75>&#34;key4&#34;</span>:<span style=color:#98c379>&#34;value4&#34;</span>}
</span></span></code></pre></div><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq .
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;key1&#34;</span>: <span style=color:#98c379>&#34;value1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;key2&#34;</span>: <span style=color:#98c379>&#34;value2&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;key3&#34;</span>: <span style=color:#98c379>&#34;value3&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;key4&#34;</span>: <span style=color:#98c379>&#34;value4&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Stream input -> JSON array output:</strong></p><p>input.json:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#e06c75>&#34;key1&#34;</span>:<span style=color:#98c379>&#34;value1&#34;</span>,<span style=color:#e06c75>&#34;key2&#34;</span>:<span style=color:#98c379>&#34;value2&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#e06c75>&#34;key3&#34;</span>:<span style=color:#98c379>&#34;value3&#34;</span>,<span style=color:#e06c75>&#34;key4&#34;</span>:<span style=color:#98c379>&#34;value4&#34;</span>}
</span></span></code></pre></div><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq -s .
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;key1&#34;</span>: <span style=color:#98c379>&#34;value1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;key2&#34;</span>: <span style=color:#98c379>&#34;value2&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;key3&#34;</span>: <span style=color:#98c379>&#34;value3&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;key4&#34;</span>: <span style=color:#98c379>&#34;value4&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p><strong>JSON array input -> stream output:</strong></p><p>input.json:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;key1&#34;</span>: <span style=color:#98c379>&#34;value1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;key2&#34;</span>: <span style=color:#98c379>&#34;value2&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;key3&#34;</span>: <span style=color:#98c379>&#34;value3&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;key4&#34;</span>: <span style=color:#98c379>&#34;value4&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq -c <span style=color:#98c379>&#39;.[]&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#e06c75>&#34;key1&#34;</span>:<span style=color:#98c379>&#34;value1&#34;</span>,<span style=color:#e06c75>&#34;key2&#34;</span>:<span style=color:#98c379>&#34;value2&#34;</span>}
</span></span><span style=display:flex><span>{<span style=color:#e06c75>&#34;key3&#34;</span>:<span style=color:#98c379>&#34;value3&#34;</span>,<span style=color:#e06c75>&#34;key4&#34;</span>:<span style=color:#98c379>&#34;value4&#34;</span>}
</span></span></code></pre></div><h4 id=object-identifier-index-filtering>Object identifier-index filtering
<a class=heading-link href=#object-identifier-index-filtering><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>input.json:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;a&#34;</span>: <span style=color:#98c379>&#34;v1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;b&#34;</span>: <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>    <span style=color:#98c379>&#34;c&#34;</span>: <span style=color:#98c379>&#34;v2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;d&#34;</span>: <span style=color:#98c379>&#34;v3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p><strong>Select key <code>a</code> from the root of the JSON:</strong></p><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;.a&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#98c379>&#34;v1&#34;</span>
</span></span></code></pre></div><p><strong>The <code>-r</code> flag selects the raw value, e.g. <code>v1</code> instead of the quoted <code>"v1"</code> string:</strong></p><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq -r <span style=color:#98c379>&#39;.a&#39;</span>
</span></span></code></pre></div><p>output:</p><pre tabindex=0><code>v1
</code></pre><p><strong>Select key <code>b</code>, and then select key <code>c</code>:</strong></p><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;.b.c&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#98c379>&#34;v2&#34;</span>
</span></span></code></pre></div><p><strong>Select key <code>a</code>, select key <code>b</code> and then select key <code>c</code> as a new key <code>bc</code>, and select key <code>d</code>:</strong></p><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;{a, bc:.b.c, d}&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;a&#34;</span>: <span style=color:#98c379>&#34;v1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;bc&#34;</span>: <span style=color:#98c379>&#34;v2&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;d&#34;</span>: <span style=color:#98c379>&#34;v3&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=array-identifier-index-filtering>Array identifier-index filtering
<a class=heading-link href=#array-identifier-index-filtering><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;.[0]&#39;</span> <span style=color:#7f848e># get the 0th item from the array</span>
</span></span><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;.[0,1]&#39;</span> <span style=color:#7f848e># get the 0th and 1st items from an array as a stream</span>
</span></span><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;.[0:3]&#39;</span> <span style=color:#7f848e># get the 0th to 3rd items from an array as a stream</span>
</span></span><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;.[-2]&#39;</span> <span style=color:#7f848e># get the 2nd last item from an array</span>
</span></span></code></pre></div><h4 id=chaining>Chaining
<a class=heading-link href=#chaining><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>The pipe operator <code>|</code> can be used to chain the different operations (filters, selectors, etc.):</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;.a | .b | .c&#39;</span> <span style=color:#7f848e># same as .a.b.c</span>
</span></span><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;.[] | .b&#39;</span> <span style=color:#7f848e># same as .[].b</span>
</span></span></code></pre></div><h4 id=mapping>Mapping
<a class=heading-link href=#mapping><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>The map function can be used to transform every object in an array.</p><p>input.json:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;a&#34;</span>: <span style=color:#98c379>&#34;value1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;b&#34;</span>: <span style=color:#98c379>&#34;value2&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;b&#34;</span>: <span style=color:#98c379>&#34;value3&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;c&#34;</span>: <span style=color:#98c379>&#34;value4&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><hr><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;map(.b)&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;value2&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#98c379>&#34;value3&#34;</span>
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><hr><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;map({a,b})&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;a&#34;</span>: <span style=color:#98c379>&#34;value1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;b&#34;</span>: <span style=color:#98c379>&#34;value2&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;a&#34;</span>: <span style=color:#e5c07b>null</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;b&#34;</span>: <span style=color:#98c379>&#34;value3&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><hr><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;map({a, b, c:&#34;value5&#34;})&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;a&#34;</span>: <span style=color:#98c379>&#34;value1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;b&#34;</span>: <span style=color:#98c379>&#34;value2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;c&#34;</span>: <span style=color:#98c379>&#34;value5&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;a&#34;</span>: <span style=color:#e5c07b>null</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;b&#34;</span>: <span style=color:#98c379>&#34;value3&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;c&#34;</span>: <span style=color:#98c379>&#34;value5&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h4 id=selecting>Selecting
<a class=heading-link href=#selecting><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>input:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[<span style=color:#d19a66>4</span>,<span style=color:#d19a66>1</span>,<span style=color:#d19a66>7</span>,<span style=color:#d19a66>5</span>,<span style=color:#d19a66>2</span>]
</span></span></code></pre></div><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq -c <span style=color:#98c379>&#39;map(select(. &gt; 3))&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[<span style=color:#d19a66>4</span>,<span style=color:#d19a66>7</span>,<span style=color:#d19a66>5</span>]
</span></span></code></pre></div><h4 id=assigning>Assigning
<a class=heading-link href=#assigning><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>input.json:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#e06c75>&#34;a&#34;</span>:<span style=color:#d19a66>1</span>}
</span></span></code></pre></div><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq <span style=color:#98c379>&#39;.b=2 | .c=3&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;a&#34;</span>: <span style=color:#d19a66>1</span>,
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;b&#34;</span>: <span style=color:#d19a66>2</span>,
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&#34;c&#34;</span>: <span style=color:#d19a66>3</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=functions>Functions
<a class=heading-link href=#functions><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>If we want to reuse a <code>jq</code> expression, we can wrap it into a function and put it into the <code>~/.jq</code> file. After that, we can simply call the function e.g. <code>jq sum</code>.</p><p><strong>Get the sum an array of numbers (ignoring nulls):</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#c678dd>def</span> <span style=color:#98c379>sum</span>: <span style=color:#e06c75>del</span>(<span style=color:#56b6c2>..</span> <span style=color:#56b6c2>|</span> <span style=color:#e06c75>nulls</span>) <span style=color:#56b6c2>|</span> <span style=color:#e06c75>add</span>;
</span></span></code></pre></div><p><strong>Get the average/mean of an array of numbers (ignoring nulls):</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#c678dd>def</span> <span style=color:#98c379>avg</span>: <span style=color:#e06c75>del</span>(<span style=color:#56b6c2>..</span> <span style=color:#56b6c2>|</span> <span style=color:#e06c75>nulls</span>) <span style=color:#56b6c2>|</span> <span style=color:#e06c75>add</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>length</span>;
</span></span></code></pre></div><p><strong>Get the median of an array of numbers (ignoring nulls):</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#c678dd>def</span> <span style=color:#98c379>median</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>del</span>(<span style=color:#56b6c2>..</span> <span style=color:#56b6c2>|</span> <span style=color:#e06c75>nulls</span>)
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>|</span> <span style=color:#e06c75>sort</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>|</span> <span style=color:#c678dd>if</span> <span style=color:#e06c75>length</span> <span style=color:#56b6c2>==</span> <span style=color:#d19a66>0</span> <span style=color:#e06c75>then</span> <span style=color:#e06c75>empty</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>elif</span> <span style=color:#e06c75>length</span>%<span style=color:#d19a66>2</span> <span style=color:#56b6c2>==</span> <span style=color:#d19a66>1</span> <span style=color:#e06c75>then</span> <span style=color:#56b6c2>.</span>[<span style=color:#e06c75>length</span><span style=color:#56b6c2>/</span><span style=color:#d19a66>2</span>]
</span></span><span style=display:flex><span>    <span style=color:#c678dd>else</span> (<span style=color:#56b6c2>.</span>[<span style=color:#e06c75>length</span><span style=color:#56b6c2>/</span><span style=color:#d19a66>2</span><span style=color:#56b6c2>-</span><span style=color:#d19a66>1</span>] <span style=color:#56b6c2>+</span> <span style=color:#56b6c2>.</span>[<span style=color:#e06c75>length</span><span style=color:#56b6c2>/</span><span style=color:#d19a66>2</span>]) <span style=color:#56b6c2>/</span> <span style=color:#d19a66>2</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>end</span>;
</span></span></code></pre></div><p><strong>Convert an array of objects to a matrix (array of arrays) without sorting the keys:</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#c678dd>def</span> <span style=color:#98c379>objs2matrix</span>:
</span></span><span style=display:flex><span>  (<span style=color:#e06c75>reduce</span> <span style=color:#56b6c2>.</span>[] <span style=color:#e06c75>as</span> $<span style=color:#e06c75>item</span> ({}; <span style=color:#56b6c2>.</span> <span style=color:#56b6c2>+</span> $<span style=color:#e06c75>item</span>) <span style=color:#56b6c2>|</span> <span style=color:#e06c75>keys_unsorted</span>) <span style=color:#e06c75>as</span> $<span style=color:#e06c75>cols</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>|</span> $<span style=color:#e06c75>cols</span>, <span style=color:#e06c75>map</span>([ <span style=color:#56b6c2>.</span>[$<span style=color:#e06c75>cols</span>[]] ])[];
</span></span></code></pre></div><p>input.json:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;h1&#34;</span>: <span style=color:#98c379>&#34;r1c1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;h2&#34;</span>: <span style=color:#98c379>&#34;r1c2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;h3&#34;</span>: <span style=color:#98c379>&#34;r1c3&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;h1&#34;</span>: <span style=color:#98c379>&#34;r2c1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;h2&#34;</span>: <span style=color:#98c379>&#34;r2c2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;h3&#34;</span>: <span style=color:#98c379>&#34;r2c3&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;h1&#34;</span>: <span style=color:#98c379>&#34;r3c1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;h2&#34;</span>: <span style=color:#98c379>&#34;r3c2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>&#34;h3&#34;</span>: <span style=color:#98c379>&#34;r3c3&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq -c objs2matrix
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[<span style=color:#98c379>&#34;h1&#34;</span>,<span style=color:#98c379>&#34;h2&#34;</span>,<span style=color:#98c379>&#34;h3&#34;</span>]
</span></span><span style=display:flex><span>[<span style=color:#98c379>&#34;r1c1&#34;</span>,<span style=color:#98c379>&#34;r1c2&#34;</span>,<span style=color:#98c379>&#34;r1c3&#34;</span>]
</span></span><span style=display:flex><span>[<span style=color:#98c379>&#34;r2c1&#34;</span>,<span style=color:#98c379>&#34;r2c2&#34;</span>,<span style=color:#98c379>&#34;r2c3&#34;</span>]
</span></span><span style=display:flex><span>[<span style=color:#98c379>&#34;r3c1&#34;</span>,<span style=color:#98c379>&#34;r3c2&#34;</span>,<span style=color:#98c379>&#34;r3c3&#34;</span>]
</span></span></code></pre></div><p><strong>Convert an array of objects to CSV format:</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#c678dd>def</span> <span style=color:#98c379>objs2csv</span>: <span style=color:#e06c75>objs2matrix</span> <span style=color:#56b6c2>|</span> <span style=color:#e06c75>@csv</span>;
</span></span></code></pre></div><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.json jq -r objs2csv
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#98c379>&#34;h1&#34;</span>,<span style=color:#98c379>&#34;h2&#34;</span>,<span style=color:#98c379>&#34;h3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#98c379>&#34;r1c1&#34;</span>,<span style=color:#98c379>&#34;r1c2&#34;</span>,<span style=color:#98c379>&#34;r1c3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#98c379>&#34;r2c1&#34;</span>,<span style=color:#98c379>&#34;r2c2&#34;</span>,<span style=color:#98c379>&#34;r2c3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#98c379>&#34;r3c1&#34;</span>,<span style=color:#98c379>&#34;r3c2&#34;</span>,<span style=color:#98c379>&#34;r3c3&#34;</span>
</span></span></code></pre></div><p><strong>Convert an array of objects to TSV format:</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-elixir data-lang=elixir><span style=display:flex><span><span style=color:#c678dd>def</span> <span style=color:#98c379>objs2tsv</span>: <span style=color:#e06c75>objs2matrix</span> <span style=color:#56b6c2>|</span> <span style=color:#e06c75>@tsv</span>;
</span></span></code></pre></div><p><strong>jq with auto-pager:</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>jq<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> -t <span style=color:#d19a66>1</span> <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span> <span style=color:#7f848e># if stdout is a tty</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> jq -C <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span> | less -R
</span></span><span style=display:flex><span>  <span style=color:#c678dd>else</span> <span style=color:#7f848e># if stdout is redirected to a pipe or file</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> jq <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>With that, I have just barely scratched the surface. There&rsquo;s so much more cool stuff in the <a href=https://jqlang.github.io/jq/manual/ class=external-link target=_blank rel=noopener><code>jq</code> docs</a> with a more in depth explanation.</p></details><h2 id=xml>XML
<a class=heading-link href=#xml><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>XML is another broadly used format to store and carry structured data. I was never a big fan of XPath and XSLT for querying and transforming XML, but I found some alternatives that worked better for me.</p><h3 id=xml2--2xml>xml2 & 2xml
<a class=heading-link href=#xml2--2xml><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><a href=https://github.com/mnhrdt/xml2 class=external-link target=_blank rel=noopener>xml2</a> can transform a nested XML structure into separate <code>/path/to/key=value</code> lines. This enables us to use tools such as <code>grep</code> to efficiently find some specific patterns within large XML files and unveil their location in the XML structure.</p><details><summary><strong>Examples:</strong> (click to expand)</summary><p><strong>Flatten an XML:</strong></p><p>input.xml:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#e06c75>&lt;project&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&lt;groupId&gt;</span>com.mycompany.app<span style=color:#e06c75>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&lt;artifactId&gt;</span>my-app<span style=color:#e06c75>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>&lt;version&gt;</span>1.0<span style=color:#e06c75>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>&lt;/project&gt;</span>
</span></span></code></pre></div><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.xml xml2
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span>/project/groupId=com.mycompany.app
</span></span><span style=display:flex><span>/project/artifactId=my-app
</span></span><span style=display:flex><span>/project/version=1.0
</span></span></code></pre></div><p><strong>Unflatten a flattened XML:</strong></p><p><code>2xml</code> can also unflatten the <code>xml2</code> flattened (+ optionally grepped) XML output back to an XML, keeping its nested structure.</p><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.xml xml2 | grep version | 2xml
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#e06c75>&lt;project&gt;&lt;version&gt;</span>1.0<span style=color:#e06c75>&lt;/version&gt;&lt;/project&gt;</span>
</span></span></code></pre></div><p><code>2xml</code> doesn&rsquo;t format the returned XML, but we can do that with <code>xq</code> (more in the next section).</p></details><h3 id=xq>xq
<a class=heading-link href=#xq><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>The <a href=https://github.com/kislyuk/yq class=external-link target=_blank rel=noopener>kislyuk/yq</a> project provides <code>xq</code> (and <code>yq</code>), a tool built on top of <code>jq</code> that can help to convert XML to JSON, and also supports <code>jq</code> queries and flags.</p><details><summary><strong>Examples:</strong> (click to expand)</summary><p><strong>Format an XML:</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>xq -x
</span></span></code></pre></div><p><strong>XML to JSON:</strong></p><p>With this shell function+alias we can convert XML to JSON and use the same <code>jq</code> queries mentioned above:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>xq<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> -t <span style=color:#d19a66>1</span> <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span> <span style=color:#7f848e># if stdout is a tty</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> xq -C <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span> | less -R
</span></span><span style=display:flex><span>  <span style=color:#c678dd>else</span> <span style=color:#7f848e># if stdout is redirected to a pipe or file</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> xq <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>alias</span> <span style=color:#e06c75>xml2json</span><span style=color:#56b6c2>=</span>xq
</span></span></code></pre></div><p><strong>JSON to XML:</strong></p><p><strong>NOTE:</strong> This is an undocumented option with limited functionality. E.g. it doesn&rsquo;t work with JSON array inputs. If the JSON input object has multiple keys, it will result in a multi-root XML which is invalid, but in this case we can pass the <code>--xml-root=root</code> option to wrap the output into a <code>root</code> element, making it a single-root XML.
<strong>NOTE:</strong> <code>bat -l XML</code> provides XML syntax highlighting in addition to paging, but it can be replaced with the more generally available <code>less</code> command if <a href=https://github.com/sharkdp/bat class=external-link target=_blank rel=noopener>bat</a> is not installed.</p><p>With this shell function we can convert JSON to XML:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>json2xml<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> -t <span style=color:#d19a66>1</span> <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span> <span style=color:#7f848e># if stdout is a tty</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> yq -x <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span> | bat -l xml
</span></span><span style=display:flex><span>  <span style=color:#c678dd>else</span> <span style=color:#7f848e># if stdout is redirected to a pipe or file</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> yq -x <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div></details><h2 id=yaml>YAML
<a class=heading-link href=#yaml><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>YAML is a common choice for config files and <em>Infrastructure as Code</em> tools because it is (arguably) more human-readable and easier to write than some other data serialization languages.</p><h3 id=yq>yq
<a class=heading-link href=#yq><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>The <a href=https://github.com/kislyuk/yq class=external-link target=_blank rel=noopener>kislyuk/yq</a> project also provides <code>yq</code>, a tool built on top of <code>jq</code> that can convert YAML to JSON, and also supports <code>jq</code> queries and flags.</p><details><summary><strong>Examples:</strong> (click to expand)</summary><p><strong>YAML to JSON:</strong></p><p>With this shell function+alias we can convert YAML to JSON and use the same <code>jq</code> queries mentioned above:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>yq<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> -t <span style=color:#d19a66>1</span> <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span> <span style=color:#7f848e># if stdout is a tty</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> yq -C <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span> | less -R
</span></span><span style=display:flex><span>  <span style=color:#c678dd>else</span> <span style=color:#7f848e># if stdout is redirected to a pipe or file</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> yq <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>alias</span> <span style=color:#e06c75>yaml2json</span><span style=color:#56b6c2>=</span>yq
</span></span></code></pre></div><p><strong>JSON to YAML:</strong></p><p><strong>NOTE:</strong> by default, custom YAML tags and styles in the input are ignored. Use the <code>-Y</code> option instead of <code>-y</code> to preserve YAML tags and styles by representing them as extra items in their enclosing mappings and sequences while in JSON</p><p>With this shell function we can convert JSON to YAML:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>json2yaml<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> -t <span style=color:#d19a66>1</span> <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span> <span style=color:#7f848e># if stdout is a tty</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> yq -y <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span> | bat -l yaml
</span></span><span style=display:flex><span>  <span style=color:#c678dd>else</span> <span style=color:#7f848e># if stdout is redirected to a pipe or file</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> yq -y <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div></details><h2 id=csv--tsv>CSV & TSV
<a class=heading-link href=#csv--tsv><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>CSV (Comma Separated Values) and TSV (Tab Separated Values) are widely used plain text formats for storing tabular data. Many applications provide a CSV export/import feature for the end user.</p><h3 id=csvtk>csvtk
<a class=heading-link href=#csvtk><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><a href=https://github.com/shenwei356/csvtk class=external-link target=_blank rel=noopener>csvtk</a> is a command-line tool for processing and manipulating CSV & TSV files with a plethora of features. It has a terrific <a href=https://bioinf.shenwei.me/csvtk/ class=external-link target=_blank rel=noopener>documentation</a> with many examples, so I only list here a few features/sub-commands that I find the most useful without going into too much detail.</p><details><summary><strong>Examples:</strong> (click to expand)</summary><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>csvtk pretty -S bold <span style=color:#7f848e># pretty print the CSV in an aligned table</span>
</span></span><span style=display:flex><span>csvtk headers <span style=color:#7f848e># print the CSV header fields</span>
</span></span><span style=display:flex><span>csvtk del-headers <span style=color:#7f848e># remove the CSV header</span>
</span></span><span style=display:flex><span>csvtk rename -f Field1,Field2 -n field1,field2 <span style=color:#7f848e># rename `Field1` to `field1` and `Field2` to `field2`</span>
</span></span><span style=display:flex><span>csvtk cut -f1 -f-1 -f Field -Ff FuzzyField <span style=color:#7f848e># get the first, last fields by their index, the field with the exact header name, and the field with the fuzzy/glob matching header name</span>
</span></span><span style=display:flex><span>csvtk grep -Ff <span style=color:#98c379>&#39;FuzzyField*&#39;</span> -rp RegexVal -i -v <span style=color:#7f848e># select the row where the fuzzy/glob matching field&#39;s value matches the regex, ignoring case and inverting matches</span>
</span></span><span style=display:flex><span>csvtk filter -f <span style=color:#98c379>&#39;Field&gt;10&#39;</span> <span style=color:#7f848e># filter the rows by values of selected fields with an arithmetic expression</span>
</span></span><span style=display:flex><span>csvtk filter2 -f <span style=color:#98c379>&#39;Field&gt;10 &amp;&amp; len(Field2)&lt;100&#39;</span> <span style=color:#7f848e># filter the rows by awk-like arithmetic/string expressions</span>
</span></span><span style=display:flex><span>csvtk transpose <span style=color:#7f848e># transpose the data matrix</span>
</span></span><span style=display:flex><span>csvtk join -f <span style=color:#98c379>&#39;username;user&#39;</span> -O/-L <span style=color:#7f848e># join CSV files by selected fields using inner/outer/left join</span>
</span></span><span style=display:flex><span>csvtk freq -f Field -n <span style=color:#7f848e># get the frequencies of the selected fields, sorting by frequency</span>
</span></span><span style=display:flex><span>csvtk summary -f 2:min,2:max,2:sum,2:mean,2:median,2:stdev | csvtk transpose | csv -H pretty <span style=color:#7f848e># fetch some statistics</span>
</span></span><span style=display:flex><span>csvtk csv2xlsx <span style=color:#7f848e># convert CSV to XLSX (Excel)</span>
</span></span><span style=display:flex><span>csvtk xlsx2csv <span style=color:#7f848e># convert XLSX (Excel) to CSV</span>
</span></span><span style=display:flex><span>csvtk csv2json <span style=color:#7f848e># convert CSV to JSON</span>
</span></span><span style=display:flex><span>csvtk plot box/hist/line <span style=color:#7f848e># plotting</span>
</span></span></code></pre></div><p><strong>Interactive CSV viewer with a fixed header:</strong></p><p><strong>NOTE:</strong> the <code>--header</code> option that keeps the first n lines fixed when scrolling is only supported in newer <code>less</code> versions</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>csv<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  csvtk pretty -S bold -n <span style=color:#d19a66>1024</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span> | less -S --header<span style=color:#56b6c2>=</span><span style=color:#d19a66>3</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>input.csv:</p><pre tabindex=0><code>firstName,middleName,lastName
John,Michael,Smith
Emily,Jane,Doe
David,,Johnson
</code></pre><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.csv csv
</span></span></code></pre></div><p>output:</p><pre tabindex=0><code>┏━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┓
┃ firstName ┃ middleName ┃ lastName ┃
┣━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━┫
┃ John      ┃ Michael    ┃ Smith    ┃
┣━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━┫
┃ Emily     ┃ Jane       ┃ Doe      ┃
┣━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━┫
┃ David     ┃            ┃ Johnson  ┃
┗━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━┛
</code></pre></details><h3 id=sqlite3>sqlite3
<a class=heading-link href=#sqlite3><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><code>sqlite3</code> can import a CSV to an in-memory db, making it possible to run SQL queries against the CSV data.</p><p><strong>NOTE:</strong> older <code>sqlite3</code> versions might not support the mentioned features</p><details><summary><strong>Examples:</strong> (click to expand)</summary><p><strong>Wrapper function for convenience:</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>csv2sqlite<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  sqlite3 -column :memory: <span style=color:#98c379>&#39;.import --csv /dev/stdin csv&#39;</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span> | less
</span></span><span style=display:flex><span>  <span style=color:#7f848e># alternative if /dev/stdin is not available: &#34;.import --csv &#39;|cat -&#39; csv&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#7f848e># or directly pass in the file, but I prefer to use the stdin as it&#39;s more flexible</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>input.csv:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csv data-lang=csv><span style=display:flex><span><span style=color:#98c379>h1</span>,<span style=color:#98c379>h2</span>,<span style=color:#98c379>h3</span>
</span></span><span style=display:flex><span><span style=color:#98c379>r1c1</span>,<span style=color:#98c379>r1c2</span>,<span style=color:#98c379>r1c3</span>
</span></span><span style=display:flex><span><span style=color:#98c379>r2c1</span>,<span style=color:#98c379>r2c2</span>,<span style=color:#98c379>r2c3</span>
</span></span><span style=display:flex><span><span style=color:#98c379>r3c1</span>,<span style=color:#98c379>r3c2</span>,<span style=color:#98c379>r3c3</span>
</span></span></code></pre></div><p><strong>Query a CSV using SQL, use table-like output:</strong></p><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.csv csv2sqlite <span style=color:#98c379>&#39;select h1,h3 from csv where h2!=&#34;r1c2&#34;&#39;</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csv data-lang=csv><span style=display:flex><span><span style=color:#98c379>h1    h3</span>
</span></span><span style=display:flex><span><span style=color:#98c379>----  ----</span>
</span></span><span style=display:flex><span><span style=color:#98c379>r2c1  r2c3</span>
</span></span><span style=display:flex><span><span style=color:#98c379>r3c1  r3c3</span>
</span></span></code></pre></div><p>By default, <code>sqlite3</code> uses the column output, but one can pass in the <code>-table</code>, <code>-box</code>, etc. flags for other output formats.</p><p><strong>Query a CSV using SQL, use CSV output:</strong></p><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.csv csv2sqlite <span style=color:#98c379>&#39;select h1,h3 from csv where h2!=&#34;r1c2&#34;&#39;</span> -csv
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-csv data-lang=csv><span style=display:flex><span><span style=color:#98c379>h1</span>,<span style=color:#98c379>h3</span>
</span></span><span style=display:flex><span><span style=color:#98c379>r2c1</span>,<span style=color:#98c379>r2c3</span>
</span></span><span style=display:flex><span><span style=color:#98c379>r3c1</span>,<span style=color:#98c379>r3c3</span>
</span></span></code></pre></div><p><strong>Query a CSV using SQL, use JSON output:</strong></p><p>command:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;input.csv csv2sqlite <span style=color:#98c379>&#39;select h1,h3 from csv where h2!=&#34;r1c2&#34;&#39;</span> -json
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>[{<span style=color:#e06c75>&#34;h1&#34;</span>:<span style=color:#98c379>&#34;r2c1&#34;</span>,<span style=color:#e06c75>&#34;h3&#34;</span>:<span style=color:#98c379>&#34;r2c3&#34;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e06c75>&#34;h1&#34;</span>:<span style=color:#98c379>&#34;r3c1&#34;</span>,<span style=color:#e06c75>&#34;h3&#34;</span>:<span style=color:#98c379>&#34;r3c3&#34;</span>}]
</span></span></code></pre></div></details><h2 id=arbitrary-text>Arbitrary text
<a class=heading-link href=#arbitrary-text><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Numerous tools are available for extracting data from plain text files, such as log files, and subsequently transforming and analyzing it.</p><h3 id=basic-unix-tools>Basic UNIX tools
<a class=heading-link href=#basic-unix-tools><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>These classic tools are usually installed by default on many UNIX-like OSes. These can be useful for arbitrary texts, but generally not well-suited for more complex file formats such as JSON, XML and CSV.</p><details><summary><strong>Examples:</strong> (click to expand)</summary><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>head -n1 <span style=color:#7f848e># get the first line</span>
</span></span><span style=display:flex><span>tail -n1 <span style=color:#7f848e># get the last line</span>
</span></span><span style=display:flex><span>cut -d: -f1,3 <span style=color:#7f848e># get the 1st and 3rd columns of a : sepearated input</span>
</span></span><span style=display:flex><span>paste -sd, <span style=color:#7f848e># join the line with commas</span>
</span></span><span style=display:flex><span>sort -nk1 <span style=color:#7f848e># sort by the first field using numeric sort</span>
</span></span><span style=display:flex><span>sort -u <span style=color:#7f848e># get the sorted and unique lines</span>
</span></span><span style=display:flex><span>sort | uniq -c <span style=color:#7f848e># sort the lines and then group-by and count the number of consecutive occurences of the same lines</span>
</span></span><span style=display:flex><span>tr -s <span style=color:#98c379>&#39; &#39;</span> <span style=color:#98c379>&#39;\n&#39;</span> <span style=color:#7f848e># replaces spaces with newlines, squeezing consequtive spaces</span>
</span></span><span style=display:flex><span>column -ts<span style=color:#98c379>$&#39;\t&#39;</span> <span style=color:#7f848e># format a TSV file so it&#39;s columns are aligned</span>
</span></span></code></pre></div></details><h3 id=less>less
<a class=heading-link href=#less><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><code>less</code> is an interactive pager that can be used to easily navigate long chunks of text with (mostly) the keyboard.</p><details><summary><strong>Examples:</strong> (click to expand)</summary><p>It supports the arrow keys and the VI-like <code>j</code>/<code>k</code> keys for vertical scrolling, but not the <code>h</code>/<code>l</code> keys out of the box.<br>But it&rsquo;s easy to fix this by putting the following key mapping into the <code>~/.lesskey</code> file:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#7f848e>#command</span>
</span></span><span style=display:flex><span>h left-scroll
</span></span><span style=display:flex><span>l right-scroll
</span></span></code></pre></div><p>and then running this command (this step is obsolete for newer <code>less</code> versions):</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>lesskey
</span></span></code></pre></div><p>Other useful shortcut keys:</p><ul><li><code>f</code>/<code>b</code>: jump to next/previous page</li><li><code>/</code>/<code>?</code>: search forward/backward</li><li><code>&</code>: display only lines matching the pattern</li><li><code>n</code>/<code>N</code>: jump to next/previous match</li><li><code>gg</code>/<code>G</code>: jump to the top/bottom of the text</li><li><code>F</code>: scroll to bottom and watch for new lines (e.g. to follow a log file)</li></ul><p>CLI flags to configure <code>less</code>:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e5c07b>export</span> <span style=color:#e06c75>LESS</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#39;-iSRF --mouse --incsearch -Q --no-vbell&#39;</span> <span style=color:#7f848e># NOTE: some of the options won&#39;t work with older less versions</span>
</span></span></code></pre></div><ul><li><code>-i</code>: case-insensitive searching</li><li><code>-S</code>: chop (do not wrap) long lines</li><li><code>-R</code>: keep ANSI color</li><li><code>-F</code>: quit if the entire text can be displayed on the screen</li><li><code>--mouse</code>: enable mouse scrolling (only in newer <code>less</code> versions)</li><li><code>--incsearch</code>: search as we type (only in newer <code>less</code> versions)</li><li><code>-Q</code>: do not beep/ring the terminal bell e.g. when reaching the end of file, and use the visual bell instead (unless we use <code>--no-vbell</code>)</li><li><code>--no-vbell</code>: disable the visual bell (only in newer <code>less</code> versions)</li></ul></details><h3 id=grep>grep
<a class=heading-link href=#grep><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><code>grep</code> is a line-oriented tool to search for text patterns within files, widely available on many UNIX-like OS-es.</p><p><strong>NOTE:</strong> there are slight differences in the different (e.g. GNU, BSD, busybox, etc.) <code>grep</code> implementations.</p><details><summary><strong>Examples:</strong> (click to expand)</summary><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>grep <span style=color:#98c379>&#39;^ *PATTERN&#39;</span> <span style=color:#7f848e># select lines that matches a Basic Regex pattern</span>
</span></span><span style=display:flex><span>grep -i <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># select lines that matches a pattern, ignoring the case</span>
</span></span><span style=display:flex><span>grep -w <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># select lines that matches a whole word</span>
</span></span><span style=display:flex><span>grep -x <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># select lines that matches the whole line</span>
</span></span><span style=display:flex><span>grep -F <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># select lines that matches a fixed substring</span>
</span></span><span style=display:flex><span>grep -e <span style=color:#98c379>&#39;PATTERN1&#39;</span> -e <span style=color:#98c379>&#39;PATTERN2&#39;</span> <span style=color:#7f848e># select lines that matches either PATTERN1 or PATTERN2</span>
</span></span><span style=display:flex><span>grep -f PATTERN_FILE <span style=color:#7f848e># select lines that matches any of the patterns in the provided PATTERN_FILE</span>
</span></span><span style=display:flex><span>grep -v <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># select lines that DO NOT matches a pattern</span>
</span></span><span style=display:flex><span>grep -o <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># select lines that matches a pattern, and only print the matched chars</span>
</span></span><span style=display:flex><span>grep -m1 <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># select only the first line that matches the pattern</span>
</span></span><span style=display:flex><span>grep -c <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># print the count of the lines that matches a pattern (instead of the matched lines)</span>
</span></span><span style=display:flex><span>grep -q <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># quiet mode, only return the exit code whether there was a match or no</span>
</span></span><span style=display:flex><span>grep -E <span style=color:#98c379>&#39;^ +PATTERN(-OPT-SUFFIX)?$&#39;</span> <span style=color:#7f848e># use extended regex with more regex features / less escaping</span>
</span></span><span style=display:flex><span>grep -Po <span style=color:#98c379>&#39;^PREFIX\KPATTERN(?=-SUFFIX)$&#39;</span> <span style=color:#7f848e># use Perl regex with even more regex features</span>
</span></span><span style=display:flex><span>grep -A1 <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># include 1 context lines before the matches</span>
</span></span><span style=display:flex><span>grep -B1 <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># include 1 context lines after the matches</span>
</span></span><span style=display:flex><span>grep -C1 <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># include 1 context lines before+after the matches</span>
</span></span><span style=display:flex><span>grep -r <span style=color:#98c379>&#39;PATTERN&#39;</span> DIRECTORY <span style=color:#7f848e># recursively grep files and show the filenames too</span>
</span></span><span style=display:flex><span>grep -rh <span style=color:#98c379>&#39;PATTERN&#39;</span> DIRECTORY <span style=color:#7f848e># recursively grep files and hide the filenames</span>
</span></span><span style=display:flex><span>grep -rl <span style=color:#98c379>&#39;PATTERN&#39;</span> DIRECTORY <span style=color:#7f848e># recursively grep files and only list the matched filenames</span>
</span></span></code></pre></div></details><h3 id=ripgrep>ripgrep
<a class=heading-link href=#ripgrep><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><a href=https://github.com/BurntSushi/ripgrep class=external-link target=_blank rel=noopener>ripgrep</a> is a modern <code>grep</code> alternative. It supports most <code>grep</code> flags and features, but it&rsquo;s significantly faster than <code>grep</code>, uses smart-case search (case-insensitive search unless the pattern contains uppercase characters), respects the <code>.gitignore</code> and other ignore files to reduce the noise and further improve the performance, has better compatibility between the different platforms, and many additional features.</p><details><summary><strong>Examples:</strong> (click to expand)</summary><p>Some additional features over <code>grep</code>:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>rg -U <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># match patterns across multiple lines</span>
</span></span><span style=display:flex><span>rg -z <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># recursively grep compressed files too (e.g. rotated log files)</span>
</span></span><span style=display:flex><span>rg --pre fastgron --pre-glob <span style=color:#98c379>&#39;*.json&#39;</span> <span style=color:#98c379>&#39;PATTERN&#39;</span> <span style=color:#7f848e># use fastgron as a preprocessor to flatten the JSON files, and then grep the flattened output </span>
</span></span></code></pre></div><p><code>rg</code> with auto-pager:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>rg<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> -t <span style=color:#d19a66>1</span> <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span> <span style=color:#7f848e># if stdout is a tty</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> rg --color<span style=color:#56b6c2>=</span>always <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span> | less -R
</span></span><span style=display:flex><span>  <span style=color:#c678dd>else</span> <span style=color:#7f848e># if stdout is redirected to a pipe or file</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>command</span> rg <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div></details><h3 id=sed>sed
<a class=heading-link href=#sed><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><code>sed</code> (stream editor), is a command-line utility used for transforming text streams. It can be used for text substitution, deletion, insertion, and more.</p><p><strong>NOTE:</strong> there are some differences between the different <code>sed</code> flavors (e.g. GNU, BSD, etc.).</p><details><summary><strong>Examples:</strong> (click to expand)</summary><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>sed <span style=color:#98c379>&#39;s/PATTERN/REPLACEMENT/&#39;</span> <span style=color:#7f848e># replace the first occurence of Basic Regex PATTERN with REPLACEMENT in each line</span>
</span></span><span style=display:flex><span>sed <span style=color:#98c379>&#39;s/PATTERN/REPLACEMENT/g&#39;</span> <span style=color:#7f848e># replace all occurences of PATTERN with REPLACEMENT in each line</span>
</span></span><span style=display:flex><span>sed -i.orig <span style=color:#98c379>&#39;s/PATTERN/REPLACEMENT/&#39;</span> FILE... <span style=color:#7f848e># edit the file(s) in-place, create a backup with the .orig extension</span>
</span></span><span style=display:flex><span>sed -E <span style=color:#98c379>&#39;s/PATTERN/REPLACEMENT/&#39;</span> <span style=color:#7f848e># use Extended Regex</span>
</span></span><span style=display:flex><span>sed <span style=color:#98c379>&#39;s/PATTERN1/REPLACEMENT1/; s/PATTERN2/REPLACEMENT2/&#39;</span> <span style=color:#7f848e># use multiple expressions v1</span>
</span></span><span style=display:flex><span>sed -e <span style=color:#98c379>&#39;s/PATTERN1/REPLACEMENT1/&#39;</span> -e <span style=color:#98c379>&#39;s/PATTERN2/REPLACEMENT2/&#39;</span> <span style=color:#7f848e># use multiple expressions v2</span>
</span></span><span style=display:flex><span>sed -n <span style=color:#98c379>&#39;/^PATTERN1/ s/PATTERN2/REPLACEMENT/p&#39;</span> <span style=color:#7f848e># only replace PATTERN2 and print the modified line if also matched PATTERN1</span>
</span></span><span style=display:flex><span>sed -e <span style=color:#98c379>&#39;/PATTERN/a\&#39;</span> -e <span style=color:#98c379>&#39;NEW_LINE&#39;</span> <span style=color:#7f848e># append NEW_LINE after line with PATTERN</span>
</span></span></code></pre></div></details><h3 id=awk>awk
<a class=heading-link href=#awk><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><code>awk</code> is a powerful tool that processes the input line by line and can perform various operations, including pattern matching, text extraction, data manipulation, and report generation.</p><p><strong>NOTE:</strong> there are some differences between the different <code>awk</code> variants (<code>gawk</code>, <code>mawk</code>, etc.).</p><details><summary><strong>Examples:</strong> (click to expand)</summary><p>Get the nth column/field:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>awk <span style=color:#98c379>&#39;{print $1}&#39;</span> <span style=color:#7f848e># get the 1st column</span>
</span></span><span style=display:flex><span>awk <span style=color:#98c379>&#39;{print $NF}&#39;</span> <span style=color:#7f848e># get the last column</span>
</span></span><span style=display:flex><span>awk <span style=color:#98c379>&#39;{print $((NF-1))}&#39;</span> <span style=color:#7f848e># get the column before the last one</span>
</span></span><span style=display:flex><span>awk -F: <span style=color:#98c379>&#39;{print $1}&#39;</span> <span style=color:#7f848e># get the first column, using : as the field separator instead of whitespace</span>
</span></span></code></pre></div><p>Get the unique lines from one or more input files without sorting:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>union<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  awk <span style=color:#98c379>&#39;!seen[$0]++&#39;</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>Get the intersection / lines that are in every input file:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>inter<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  awk <span style=color:#98c379>&#39;FNR==1{if (NR!=1) delete seen_file; files++}
</span></span></span><span style=display:flex><span><span style=color:#98c379>    !($0 in seen_file) {seen_file[$0]=1; seen[$0]++}
</span></span></span><span style=display:flex><span><span style=color:#98c379>    END {for (e in seen) if (seen[e]==files) print e}&#39;</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>Get the lines from first file that are not in the 2nd+ files:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>minus<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  awk <span style=color:#98c379>&#39;FNR==1 {file++}
</span></span></span><span style=display:flex><span><span style=color:#98c379>  file==1 {seen[$0]=1}
</span></span></span><span style=display:flex><span><span style=color:#98c379>  file&gt;=2 {delete seen[$0]}
</span></span></span><span style=display:flex><span><span style=color:#98c379>  END {for (e in seen) print e}&#39;</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$@</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>Get the min of line or space separated numbers from the stdin:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>min<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  awk <span style=color:#98c379>&#39;{if(min==&#34;&#34;){min=$1};
</span></span></span><span style=display:flex><span><span style=color:#98c379>    for (i=1; i&lt;=NF; i++) if (min&gt;$i) min=$i}
</span></span></span><span style=display:flex><span><span style=color:#98c379>    END {if (min!=&#34;&#34;) print min}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>Get the max of line or space separated numbers from the stdin:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>max<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  awk <span style=color:#98c379>&#39;{if(max==&#34;&#34;){max=$1};
</span></span></span><span style=display:flex><span><span style=color:#98c379>    for (i=1; i&lt;=NF; i++) if (max&lt;$i) max=$i}
</span></span></span><span style=display:flex><span><span style=color:#98c379>    END {if (max!=&#34;&#34;) print max}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>Get the sum of line or space separated numbers from the stdin:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>sum<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  awk <span style=color:#98c379>&#39;{for (i=1; i&lt;=NF; i++) sum+=$i}
</span></span></span><span style=display:flex><span><span style=color:#98c379>    END {if (sum!=&#34;&#34;) print sum}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>Get the average of line or space separated numbers from the stdin:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>avg<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  awk <span style=color:#98c379>&#39;{for (i=1; i&lt;=NF; i++) {sum+=$i;count++}}
</span></span></span><span style=display:flex><span><span style=color:#98c379>    END {if (count&gt;0) print sum/count}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div><p>Get the median of line or space separated numbers from the stdin:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>median<span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  <span style=color:#7f848e># only GNU awk has a sorting function, so we use the more compatible `sort -g` instead</span>
</span></span><span style=display:flex><span>  tr -s <span style=color:#98c379>&#39;[:space:]&#39;</span> <span style=color:#98c379>&#39;\n&#39;</span> <span style=color:#98c379>\
</span></span></span><span style=display:flex><span><span style=color:#98c379></span>  | sort -g <span style=color:#98c379>\
</span></span></span><span style=display:flex><span><span style=color:#98c379></span>  | awk <span style=color:#98c379>&#39;{a[NR]=$1}
</span></span></span><span style=display:flex><span><span style=color:#98c379>      END {if (NR%2==1) {print a[(NR+1)/2]} else {print (a[NR/2] + a[NR/2+1]) / 2.0}}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>}</span>
</span></span></code></pre></div></details><h3 id=perl>perl
<a class=heading-link href=#perl><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><code>perl</code> is a general-purpose scripting language with strong text-processing capabilities. There are a couple of use-cases when it can be handy:</p><ul><li>If <code>sed</code> or <code>awk</code> is not sufficient and we need a powerful programming language, or feature (e.g. PCRE regex)</li><li>When the task requires multi-platform compatibility (e.g. <code>sed</code> and <code>awk</code> have multiple flavours with some differences)</li><li>There are some other edge cases, like UTF8 uppercasing/lowercasing (some <code>tr</code> versions only work with ASCII).</li></ul><details><summary><strong>Examples:</strong> (click to expand)</summary><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>perl -pe <span style=color:#98c379>&#39;s/pattern/replacement/g&#39;</span> <span style=color:#7f848e># replace pattern with replacement using PCRE regex</span>
</span></span><span style=display:flex><span>perl -Mopen<span style=color:#56b6c2>=</span>locale -Mutf8 -pe <span style=color:#98c379>&#39;$_=uc&#39;</span> <span style=color:#7f848e># uppercase UTF-8 text</span>
</span></span><span style=display:flex><span>perl -Mopen<span style=color:#56b6c2>=</span>locale -Mutf8 -pe <span style=color:#98c379>&#39;$_=lc&#39;</span> <span style=color:#7f848e># lowercase UTF-8 text</span>
</span></span><span style=display:flex><span>perl -ne <span style=color:#98c379>&#39;(/start/../end/) &amp;&amp; print&#39;</span> <span style=color:#7f848e># print out the lines between two matching lines</span>
</span></span><span style=display:flex><span>perl -MO<span style=color:#56b6c2>=</span>Deparse <span style=color:#7f848e># see what a perl one-liner does under the hood</span>
</span></span></code></pre></div></details></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2025
Barnabás Ágoston
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script async defer data-website-id=e1c84693-afd2-4266-9c8e-2dede378f818 src=https://analytics.eu.umami.is/script.js></script></body></html>